<!-- START OF FILE addms.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MittalMart - ChefAdmin</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --primary: #d32f2f; --secondary: #f57c00; --bg: #f3f4f6; --white: #ffffff; --text: #1f2937; --border: #e5e7eb; --radius: 8px; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background-color: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        aside { width: 250px; background: #1e1e2d; color: white; display: flex; flex-direction: column; padding: 20px; }
        .logo { font-size: 1.5rem; font-weight: 800; color: #ff5252; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; letter-spacing: 1px; }
        .nav-item { padding: 12px 15px; border-radius: var(--radius); cursor: pointer; color: #a6a6b7; font-weight: 600; margin-bottom: 5px; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover { background: #2a2a3c; color: white; }
        .nav-item.active { background: #d32f2f; color: white; box-shadow: 0 4px 10px rgba(211, 47, 47, 0.3); }

        main { flex: 1; padding: 30px; overflow-y: auto; }
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        h2 { font-size: 1.8rem; font-weight: 700; }
        
        .btn { padding: 10px 20px; border-radius: var(--radius); border: none; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        
        /* DATE PICKER */
        .date-control { display: flex; align-items: center; gap: 10px; background: white; padding: 5px 10px; border-radius: 8px; border: 1px solid #ddd; }
        .date-control input { border: none; outline: none; font-family: 'Segoe UI', sans-serif; font-size: 0.95rem; color: #333; }

        /* KPI & ANALYTICS */
        .kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .kpi-card { background: white; padding: 20px; border-radius: 12px; border-left: 5px solid var(--primary); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .kpi-val { font-size: 1.8rem; font-weight: 800; color: #111; margin-bottom: 5px; }
        .kpi-lbl { font-size: 0.85rem; color: #666; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        .analytics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .chart-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .chart-full { grid-column: 1 / -1; }

        /* TABLES */
        .table-container { background: white; border-radius: 12px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; text-align: left; padding: 15px; font-size: 0.85rem; color: #555; text-transform: uppercase; font-weight: 700; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 0.95rem; vertical-align: middle; }
        
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; }
        .status-Received { background: #fff3e0; color: #e65100; }
        .status-Picking { background: #e3f2fd; color: #1565c0; }
        .status-Ready { background: #e8f5e9; color: #2e7d32; }
        .status-Completed { background: #f3f4f6; color: #374151; }
        .table-tag { background: #1e1e2d; color: #fff; padding: 4px 8px; border-radius: 4px; font-weight: 700; font-family: monospace; }
        
        .timer-tag { font-family: monospace; font-weight: bold; padding: 2px 6px; border-radius: 4px; }
        .new-order-anim { animation: flash 1s; }
        @keyframes flash { 0% { background-color: #fff; } 50% { background-color: #ffebee; } 100% { background-color: #fff; } }

        /* SETTINGS FORM STYLES */
        .settings-card { background: white; padding: 25px; border-radius: 12px; max-width: 600px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: #333; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .banner-preview { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; color: #880e4f; box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4); }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 100; opacity: 0; pointer-events: none; transition: 0.2s; }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        .modal { background: white; width: 400px; padding: 25px; border-radius: 12px; transform: translateY(20px); transition: 0.3s; }
        .modal-overlay.open .modal { transform: translateY(0); }
        .form-group select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; }

    </style>
</head>
<body>
    <aside>
        <div class="logo">üî• KITCHEN OS</div>
        <div class="nav-item active" onclick="switchView('live')">‚ö° Live Monitor</div>
        <div class="nav-item" onclick="switchView('analytics')">üìä Analytics</div>
        <div class="nav-item" onclick="switchView('inventory')">üçî Menu Editor</div>
        <div class="nav-item" onclick="switchView('categories')">üìÇ Categories</div>
        <div class="nav-item" onclick="switchView('settings')">‚öôÔ∏è Settings</div>
    </aside>

    <main>
        <!-- VIEW 1: LIVE MONITOR -->
        <div id="view-live" class="view-section active">
            <div class="header">
                <h2>Live Orders</h2>
                <div style="font-size: 0.9rem; color: #666;">Showing last 50 orders</div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Table</th>
                            <th>Placed At</th>
                            <th>Prep Time</th>
                            <th>Items</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="live-body"></tbody>
                </table>
            </div>
        </div>

        <!-- VIEW 2: ANALYTICS -->
        <div id="view-analytics" class="view-section">
            <div class="header">
                <h2>Business Insights</h2>
                <!-- DATE PICKER -->
                <div class="date-control">
                    <span style="font-size:1.2rem;">üìÖ</span>
                    <input type="date" id="analytics-date" onchange="loadAnalyticsData()">
                </div>
            </div>

            <div class="kpi-row">
                <div class="kpi-card"><div class="kpi-val" id="kpi-rev">‚Çπ0</div><div class="kpi-lbl" id="lbl-rev">Revenue (Today)</div></div>
                <div class="kpi-card"><div class="kpi-val" id="kpi-orders">0</div><div class="kpi-lbl">Orders Fulfilled</div></div>
                <div class="kpi-card" style="border-left-color: #0288d1;"><div class="kpi-val" id="kpi-time">0m</div><div class="kpi-lbl">Avg Prep Time</div></div>
                <div class="kpi-card" style="border-left-color: #f57c00;"><div class="kpi-val" id="kpi-top">--</div><div class="kpi-lbl">Top Dish</div></div>
            </div>

            <div class="analytics-grid">
                <div class="chart-card chart-full"><h3>üìà Revenue Trend (Last 7 Days)</h3><div style="height: 250px;"><canvas id="chartRevenue"></canvas></div></div>
                <div class="chart-card"><h3 id="hourly-title">üïí Hourly Rush</h3><div style="height: 250px;"><canvas id="chartPeakHours"></canvas></div></div>
                <div class="chart-card"><h3 id="top-title">üèÜ Product Mix</h3><div style="height: 250px;"><canvas id="chartTopItems"></canvas></div></div>
            </div>
        </div>

        <!-- VIEW 3: INVENTORY -->
        <div id="view-inventory" class="view-section">
            <div class="header"><h2>Menu Management</h2><button class="btn btn-primary" onclick="openModal()">+ Add Dish</button></div>
            <div class="table-container">
                <table>
                    <thead><tr><th>Img</th><th>Dish Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Actions</th></tr></thead>
                    <tbody id="inv-body"></tbody>
                </table>
            </div>
        </div>
        
        <!-- VIEW 4: CATEGORIES -->
        <div id="view-categories" class="view-section">
             <div class="header"><h2>Category Management</h2><button class="btn btn-primary" onclick="openCatModal()">+ Add Category</button></div>
             <div id="cat-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:15px;"></div>
        </div>

        <!-- VIEW 5: SETTINGS (NEW) -->
        <div id="view-settings" class="view-section">
            <div class="header"><h2>Store Configuration</h2></div>
            <div class="settings-card">
                <h3 style="margin-bottom:20px;">üì¢ Kiosk Banner</h3>
                <!-- Preview -->
                <div class="banner-preview">
                    <div>
                        <h2 id="prev-title" style="margin:0; font-size:1.4rem;">Heading</h2>
                        <p id="prev-msg" style="margin:5px 0 0 0; font-weight:500;">Subtext goes here</p>
                    </div>
                    <div id="prev-icon" style="font-size:2.5rem;">‚ú®</div>
                </div>

                <form onsubmit="saveSettings(event)">
                    <div class="form-group">
                        <label>Banner Headline</label>
                        <input type="text" id="set-ban-title" placeholder="e.g. Hungry?" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Banner Message</label>
                        <input type="text" id="set-ban-msg" placeholder="e.g. Try our new spicy burger!" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>Banner Icon (Emoji)</label>
                        <input type="text" id="set-ban-icon" placeholder="e.g. üçî" oninput="updatePreview()">
                    </div>
                    <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
                    <h3 style="margin-bottom:15px;">üîí Security</h3>
                    <div class="form-group">
                        <label>Admin PIN (For Table Reset)</label>
                        <input type="text" id="set-pin" placeholder="Enter 4-digit PIN">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%;">Save Configuration</button>
                </form>
            </div>
        </div>

    </main>

    <!-- MODALS -->
    <div class="modal-overlay" id="item-modal"><div class="modal"><h3>Dish Details</h3><form id="item-form" onsubmit="handleSave(event)"><input type="hidden" id="inp-id"><div class="form-group"><label>Name</label><input type="text" id="inp-name" required></div><div class="form-group"><label>Category</label><select id="inp-cat" required></select></div><div class="form-group"><label>Price (‚Çπ)</label><input type="number" id="inp-price" step="0.01" required></div><div class="form-group"><label>Image URL</label><input type="text" id="inp-img"></div><div class="modal-actions"><button type="button" class="btn" onclick="closeModal('item-modal')" style="background:#eee; margin-right:10px;">Cancel</button><button type="submit" class="btn btn-primary">Save</button></div></form></div></div>
    <div class="modal-overlay" id="cat-modal"><div class="modal"><h3>New Category</h3><form onsubmit="handleCatSave(event)"><div class="form-group"><label>Name</label><input type="text" id="new-cat-name" required></div><div class="form-group"><label>Image</label><input type="text" id="new-cat-img" required></div><div class="modal-actions"><button type="button" class="btn" onclick="closeModal('cat-modal')" style="background:#eee; margin-right:10px;">Cancel</button><button type="submit" class="btn btn-primary">Create</button></div></form></div></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDrbVUUk2hH2_2LaWvaRSQIGqSbQnsC5pQ", authDomain: "kiosk-4d556.firebaseapp.com", projectId: "kiosk-4d556", storageBucket: "kiosk-4d556.firebasestorage.app", messagingSenderId: "15848211380", appId: "1:15848211380:web:0afd9de1f69ea490aba8e1", measurementId: "G-CBRRT8JFQV" };
        firebase.initializeApp(firebaseConfig); const db = firebase.firestore();

        let ITEMS = [];
        let CATEGORIES = [];
        let CHART_INSTANCES = {};

        async function init() {
            // Default Date
            document.getElementById('analytics-date').valueAsDate = new Date();
            
            await loadCats();
            await loadInv();
            listenToLiveOrders();
            loadAnalyticsData();
            loadSettings(); // Load settings on start
        }

        function switchView(id) {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            if(id === 'analytics') loadAnalyticsData();
        }

        function formatTime12(timestamp) {
            if(!timestamp) return '--:--';
            const d = new Date(timestamp.seconds * 1000);
            return d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
        }

        // --- 0. SETTINGS LOGIC ---
        function updatePreview() {
            document.getElementById('prev-title').innerText = document.getElementById('set-ban-title').value || 'Heading';
            document.getElementById('prev-msg').innerText = document.getElementById('set-ban-msg').value || 'Subtext';
            document.getElementById('prev-icon').innerText = document.getElementById('set-ban-icon').value || '‚ú®';
        }

        async function loadSettings() {
            const doc = await db.collection('settings').doc('storeConfig').get();
            if(doc.exists) {
                const data = doc.data();
                document.getElementById('set-ban-title').value = data.bannerTitle || '';
                document.getElementById('set-ban-msg').value = data.bannerMsg || '';
                document.getElementById('set-ban-icon').value = data.bannerIcon || '';
                document.getElementById('set-pin').value = data.adminPin || '';
                updatePreview();
            } else {
                // Defaults
                document.getElementById('set-ban-title').value = "Hungry?";
                document.getElementById('set-ban-msg').value = "Try our special menu today!";
                document.getElementById('set-ban-icon').value = "üòã";
                document.getElementById('set-pin').value = "1234";
                updatePreview();
            }
        }

        async function saveSettings(e) {
            e.preventDefault();
            const data = {
                bannerTitle: document.getElementById('set-ban-title').value,
                bannerMsg: document.getElementById('set-ban-msg').value,
                bannerIcon: document.getElementById('set-ban-icon').value,
                adminPin: document.getElementById('set-pin').value
            };
            await db.collection('settings').doc('storeConfig').set(data);
            alert("Settings Saved!");
        }

        // --- 1. LIVE MONITOR ---
        function listenToLiveOrders() {
            db.collection('orders').orderBy('timestamp', 'desc').limit(50).onSnapshot(snap => {
                  const tbody = document.getElementById('live-body');
                  tbody.innerHTML = '';
                  if(snap.empty) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:30px; color:#888;">No Data</td></tr>'; return; }
                  
                  const orders = snap.docs.map(d => ({id:d.id, ...d.data()}));
                  orders.forEach(o => {
                      const itemsStr = o.items.map(i => `${i.qty}x ${i.name}`).join(', ');
                      const tableDisplay = o.tableId ? `T-${o.tableId}` : 'Takeaway';
                      
                      let prepTimeDisplay = '--';
                      let rowClass = '';
                      if (o.status === 'Completed' && o.completedAt && o.timestamp) {
                          const diffMs = (o.completedAt.seconds - o.timestamp.seconds) * 1000;
                          const diffMins = Math.round(diffMs / 60000);
                          prepTimeDisplay = `<span style="color:#2e7d32; font-weight:800; background:#e8f5e9; padding:2px 6px; border-radius:4px;">${diffMins} min</span>`;
                      } else if (o.timestamp) {
                          const diffMs = new Date() - new Date(o.timestamp.seconds * 1000);
                          const diffMins = Math.floor(diffMs / 60000);
                          prepTimeDisplay = `<span style="color:#e65100; font-weight:bold; background:#fff3e0; padding:2px 6px; border-radius:4px;">‚è± ${diffMins}m (Run)</span>`;
                          if(o.status !== 'Completed') rowClass = 'new-order-anim';
                      }

                      tbody.innerHTML += `
                        <tr class="${rowClass}">
                            <td style="font-weight:bold;">${o.id}</td>
                            <td><span class="table-tag">${tableDisplay}</span></td>
                            <td>${formatTime12(o.timestamp)}</td>
                            <td>${prepTimeDisplay}</td>
                            <td style="max-width:250px;">${itemsStr}</td>
                            <td><span class="status-badge status-${o.status}">${o.status}</span></td>
                        </tr>
                      `;
                  });
              });
        }

        // --- 2. ANALYTICS ---
        async function loadAnalyticsData() {
            const dateInput = document.getElementById('analytics-date');
            const selectedDate = new Date(dateInput.value);
            const startOfDay = new Date(selectedDate); startOfDay.setHours(0,0,0,0);
            const endOfDay = new Date(selectedDate); endOfDay.setHours(23,59,59,999);

            const daySnap = await db.collection('orders').where('timestamp', '>=', startOfDay).where('timestamp', '<=', endOfDay).get();
            const dayOrders = daySnap.docs.map(d => d.data());

            const trendStart = new Date(); trendStart.setDate(trendStart.getDate() - 7);
            const trendSnap = await db.collection('orders').where('timestamp', '>=', trendStart).orderBy('timestamp', 'asc').get();
            const trendOrders = trendSnap.docs.map(d => d.data());

            let hourly = new Array(24).fill(0);
            let itemSales = {};
            let dayRevenue = 0;
            let dayPrepTimeTotal = 0; let dayCompletedCount = 0;

            dayOrders.forEach(o => {
                if(o.timestamp) hourly[new Date(o.timestamp.seconds * 1000).getHours()]++;
                dayRevenue += o.total;
                o.items.forEach(i => itemSales[i.name] = (itemSales[i.name] || 0) + i.qty);
                if(o.status === 'Completed' && o.completedAt && o.timestamp) {
                    dayPrepTimeTotal += (o.completedAt.seconds - o.timestamp.seconds) / 60;
                    dayCompletedCount++;
                }
            });

            let dailyTrend = {};
            trendOrders.forEach(o => {
                if(o.timestamp) {
                    const dKey = new Date(o.timestamp.seconds * 1000).toLocaleDateString('en-US', {weekday:'short'});
                    if(!dailyTrend[dKey]) dailyTrend[dKey] = 0;
                    dailyTrend[dKey] += o.total;
                }
            });

            document.getElementById('lbl-rev').innerText = `Revenue (${selectedDate.toLocaleDateString()})`;
            document.getElementById('kpi-rev').innerText = `‚Çπ${dayRevenue.toFixed(0)}`;
            document.getElementById('kpi-orders').innerText = dayCompletedCount;
            document.getElementById('kpi-time').innerText = dayCompletedCount > 0 ? `${Math.round(dayPrepTimeTotal/dayCompletedCount)} min` : "--";
            
            const sortedItems = Object.entries(itemSales).sort((a,b)=>b[1]-a[1]);
            document.getElementById('kpi-top').innerText = sortedItems.length ? sortedItems[0][0] : '--';
            document.getElementById('hourly-title').innerText = `üïí Hourly Rush (${selectedDate.toLocaleDateString()})`;
            document.getElementById('top-title').innerText = `üèÜ Product Mix (${selectedDate.toLocaleDateString()})`;

            renderCharts(dailyTrend, hourly, sortedItems.slice(0,5));
        }

        function renderCharts(dailyTrend, hourly, topItems) {
            const ctxRev = document.getElementById('chartRevenue').getContext('2d');
            if(CHART_INSTANCES['rev']) CHART_INSTANCES['rev'].destroy();
            CHART_INSTANCES['rev'] = new Chart(ctxRev, {
                type: 'line',
                data: {
                    labels: Object.keys(dailyTrend),
                    datasets: [{ label: 'Sales (‚Çπ)', data: Object.values(dailyTrend), borderColor: '#2e7d32', backgroundColor: 'rgba(46, 125, 50, 0.1)', fill: true, tension: 0.3 }]
                }, options: { maintainAspectRatio:false }
            });

            const ctxPeak = document.getElementById('chartPeakHours').getContext('2d');
            if(CHART_INSTANCES['peak']) CHART_INSTANCES['peak'].destroy();
            CHART_INSTANCES['peak'] = new Chart(ctxPeak, {
                type: 'bar',
                data: {
                    labels: ['8AM','10AM','12PM','2PM','4PM','6PM','8PM','10PM'],
                    datasets: [{ label: 'Orders', data: [8,10,12,14,16,18,20,22].map(h=>hourly[h]), backgroundColor: '#f57c00' }]
                }, options: { maintainAspectRatio:false }
            });

            const ctxTop = document.getElementById('chartTopItems').getContext('2d');
            if(CHART_INSTANCES['top']) CHART_INSTANCES['top'].destroy();
            CHART_INSTANCES['top'] = new Chart(ctxTop, {
                type: 'doughnut',
                data: {
                    labels: topItems.map(x=>x[0]),
                    datasets: [{ data: topItems.map(x=>x[1]), backgroundColor: ['#d32f2f', '#f57c00', '#1976d2', '#388e3c', '#7b1fa2'] }]
                }, options: { maintainAspectRatio:false, plugins:{legend:{position:'right'}} }
            });
        }

        // --- INVENTORY ---
        async function loadCats() {
            const s = await db.collection('categories').get();
            CATEGORIES = s.docs.map(d=>({id:d.id, ...d.data()}));
            document.getElementById('inp-cat').innerHTML = CATEGORIES.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
            const g = document.getElementById('cat-grid'); g.innerHTML='';
            CATEGORIES.forEach(c=>{ g.innerHTML += `<div style="background:white; padding:10px; border-radius:8px; display:flex; align-items:center; gap:10px; border:1px solid #eee;"><img src="${c.img}" style="width:30px; height:30px;"><div><strong>${c.name}</strong></div><button onclick="delCat('${c.id}')" style="margin-left:auto; color:red; border:none; cursor:pointer;">√ó</button></div>`; });
        }
        async function loadInv() {
            const s = await db.collection('items').get();
            ITEMS = s.docs.map(d=>d.data());
            const tb = document.getElementById('inv-body'); tb.innerHTML='';
            ITEMS.forEach(i => {
                tb.innerHTML += `<tr><td><img src="${i.image||''}" style="width:40px; height:40px; border-radius:4px;"></td><td><strong>${i.name}</strong></td><td>${i.category}</td><td>‚Çπ${i.price}</td><td><button onclick="togStock('${i.id}')" style="cursor:pointer; border:none; background:${i.available?'#e8f5e9':'#ffebee'}; color:${i.available?'green':'red'}; padding:4px 8px; border-radius:4px;">${i.available?'In Stock':'Sold Out'}</button></td><td><button onclick="delItem('${i.id}')" style="border:none; color:red; background:none; cursor:pointer;">üóë</button></td></tr>`;
            });
        }
        
        function openModal(){ document.getElementById('item-form').reset(); document.getElementById('item-modal').classList.add('open'); }
        function openCatModal(){ document.getElementById('cat-modal').classList.add('open'); }
        function closeModal(id){ document.getElementById(id).classList.remove('open'); }
        async function handleSave(e){ e.preventDefault(); const id = String(Date.now()); const data = { id: Number(id), name: document.getElementById('inp-name').value, category: document.getElementById('inp-cat').value, price: parseFloat(document.getElementById('inp-price').value), image: document.getElementById('inp-img').value, available: true }; await db.collection('items').doc(id).set(data); closeModal('item-modal'); loadInv(); }
        async function handleCatSave(e){ e.preventDefault(); const n = document.getElementById('new-cat-name').value; const id = n.replace(/\s+/g,''); await db.collection('categories').doc(id).set({id, name:n, img:document.getElementById('new-cat-img').value}); closeModal('cat-modal'); loadCats(); }
        async function togStock(id){ const i=ITEMS.find(x=>String(x.id)===String(id)); if(i) await db.collection('items').doc(String(id)).update({available:!i.available}); loadInv(); }
        async function delItem(id){ if(confirm('Delete?')) await db.collection('items').doc(String(id)).delete(); loadInv(); }
        async function delCat(id){ if(confirm('Delete?')) await db.collection('categories').doc(id).delete(); loadCats(); }

        init();
    </script>
</body>
</html>
