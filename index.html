<!-- START OF FILE customer.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Kiosk</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root { 
            --primary: #ea1d2c; /* Zomato/KFC Red */
            --primary-dark: #c0131f;
            --bg-body: #f8f9fa;
            --bg-sidebar: #ffffff;
            --text-main: #1c1c1c;
            --text-light: #666666;
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
            --radius: 16px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-body); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        /* --- SIDEBAR (Categories) --- */
        aside {
            width: 100px; background: var(--bg-sidebar); height: 100%; display: flex; flex-direction: column; align-items: center; border-right: 1px solid #eee; padding-top: 20px; overflow-y: auto; z-index: 20; flex-shrink: 0;
        }
        @media(min-width: 800px) { aside { width: 220px; align-items: stretch; padding: 20px; } }

        .brand-icon { font-size: 1.8rem; margin-bottom: 30px; text-align: center; }
        
        .cat-item { display: flex; flex-direction: column; align-items: center; padding: 15px 10px; cursor: pointer; transition: 0.2s; border-radius: 12px; margin-bottom: 10px; color: var(--text-light); }
        @media(min-width: 800px) { .cat-item { flex-direction: row; gap: 15px; padding: 12px 15px; } .cat-item img { width: 30px; height: 30px; } }
        
        .cat-item:hover { background: #fff5f5; color: var(--primary); }
        .cat-item.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(234, 29, 44, 0.3); }
        
        .cat-img { width: 40px; height: 40px; object-fit: contain; margin-bottom: 5px; }
        @media(min-width: 800px) { .cat-img { margin-bottom: 0; } }
        
        .cat-name { font-size: 0.75rem; font-weight: 600; text-align: center; }
        @media(min-width: 800px) { .cat-name { font-size: 0.95rem; text-align: left; } }

        /* --- MAIN CONTENT --- */
        main { flex: 1; display: flex; flex-direction: column; position: relative; }

        /* Header */
        header { padding: 15px 25px; background: white; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .header-title h1 { font-size: 1.2rem; font-weight: 700; }
        .header-title span { font-size: 0.85rem; color: var(--text-light); }
        
        .table-pill { background: #222; color: white; padding: 6px 15px; border-radius: 30px; font-size: 0.9rem; font-weight: 600; cursor: pointer; }

        /* Search & Banner */
        .content-scroll { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        
        .search-box { background: white; border-radius: 12px; padding: 12px 15px; display: flex; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .search-box input { border: none; outline: none; width: 100%; margin-left: 10px; font-size: 1rem; }

        /* DYNAMIC BANNER */
        .hero-banner {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
            border-radius: var(--radius);
            padding: 20px; margin-bottom: 25px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4);
            transition: all 0.3s ease;
        }
        .hero-text h2 { font-size: 1.5rem; color: #b71c1c; margin-bottom: 5px; }
        .hero-text p { color: #880e4f; font-size: 0.9rem; font-weight: 500; }
        .hero-icon { font-size: 3rem; }

        /* Product Grid */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        @media(min-width: 1000px) { .products-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); } }

        .dish-card { background: white; border-radius: var(--radius); padding: 12px; box-shadow: var(--shadow); transition: transform 0.2s; display: flex; flex-direction: column; position: relative; }
        .dish-card:active { transform: scale(0.98); }

        .dish-img-box { height: 120px; border-radius: 12px; background: #f4f4f4; overflow: hidden; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; }
        .dish-img { width: 100%; height: 100%; object-fit: cover; }
        
        .food-type { position: absolute; top: 12px; left: 12px; width: 16px; height: 16px; background: white; border: 1px solid; padding: 2px; display: flex; align-items: center; justify-content: center; border-radius: 4px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
        .type-veg { border-color: #2e7d32; } .type-veg .dot { background: #2e7d32; }
        .type-nonveg { border-color: #d32f2f; } .type-nonveg .dot { background: #d32f2f; }

        .dish-info h3 { font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; line-height: 1.2; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 38px;}
        .dish-price { font-size: 1rem; font-weight: 700; color: #333; margin-top: 5px; }

        .action-row { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .btn-add { background: white; border: 1px solid #ddd; color: var(--primary); font-weight: 700; padding: 6px 18px; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 0.85rem; }
        .qty-pill { display: flex; align-items: center; background: var(--primary); color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(234, 29, 44, 0.3); }
        .qty-btn { padding: 6px 12px; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .qty-val { font-weight: 600; font-size: 0.9rem; min-width: 20px; text-align: center; }

        /* CART FLOATER */
        .cart-bar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 600px; background: #222; color: white; padding: 15px 25px; border-radius: 50px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); cursor: pointer; z-index: 100; animation: slideUp 0.3s; }
        .cart-info { display: flex; flex-direction: column; }
        .cart-total { font-size: 1.1rem; font-weight: 700; }
        .cart-sub { font-size: 0.8rem; color: #aaa; }
        .btn-view-cart { font-weight: 700; font-size: 1rem; display: flex; align-items: center; gap: 8px; }

        .hidden { display: none !important; }
        @keyframes slideUp { from{transform:translate(-50%, 100%);} to{transform:translate(-50%, 0);} }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 999; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .modal-sheet { background: white; width: 90%; max-width: 450px; padding: 25px; border-radius: 20px; animation: popIn 0.2s; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        @keyframes popIn { from{transform:scale(0.9); opacity:0;} to{transform:scale(1); opacity:1;} }
        .summary-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f4f4f4; }
        .btn-primary-block { width: 100%; background: var(--primary); color: white; padding: 15px; border-radius: 12px; border: none; font-weight: 700; font-size: 1rem; margin-top: 15px; cursor: pointer; }
        .btn-text { width: 100%; background: none; border: none; color: #666; padding: 10px; margin-top: 5px; cursor: pointer; }

    </style>
</head>
<body>

    <aside id="sidebar">
        <div class="brand-icon">üçî</div>
        <!-- Categories injected here -->
    </aside>

    <main>
        <header>
            <div class="header-title">
                <h1>Menu</h1>
                <span>Pick your favorites</span>
            </div>
            <div class="table-pill" id="table-display" onclick="resetTable()">Table --</div>
        </header>

        <div class="content-scroll">
            
            <!-- DYNAMIC BANNER (Now hooked to Firebase Settings) -->
            <div class="hero-banner">
                <div class="hero-text">
                    <h2 id="ban-title">Loading...</h2>
                    <p id="ban-msg">Please wait</p>
                </div>
                <div class="hero-icon" id="ban-icon">‚ú®</div>
            </div>

            <div class="search-box">
                <span>üîç</span>
                <input type="text" id="search-inp" placeholder="Search for burger, fries, coke...">
            </div>

            <div id="product-grid" class="products-grid">
                <!-- Products injected here -->
                <div style="grid-column:1/-1; text-align:center; padding:40px; color:#999;">Loading Menu...</div>
            </div>
        </div>
        
        <div id="cart-floater" class="cart-bar hidden" onclick="openCheckout()">
            <div class="cart-info">
                <span class="cart-total" id="cart-total">‚Çπ0</span>
                <span class="cart-sub" id="cart-count">0 Items</span>
            </div>
            <div class="btn-view-cart">View Cart ‚ûî</div>
        </div>
    </main>

    <!-- MODAL -->
    <div id="checkout-modal" class="modal-overlay hidden">
        <div class="modal-sheet" id="modal-content"></div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDrbVUUk2hH2_2LaWvaRSQIGqSbQnsC5pQ", authDomain: "kiosk-4d556.firebaseapp.com", projectId: "kiosk-4d556", storageBucket: "kiosk-4d556.firebasestorage.app", messagingSenderId: "15848211380", appId: "1:15848211380:web:0afd9de1f69ea490aba8e1", measurementId: "G-CBRRT8JFQV" };
        firebase.initializeApp(firebaseConfig); 
        const db = firebase.firestore();

        // STATE
        let ALL_ITEMS = [];
        let CATEGORIES = [];
        let CART = {};
        let ACTIVE_CAT = 'All';
        let STORE_CONFIG = { adminPin: "1234" }; // Default

        // --- TABLE ID SETUP ---
        let TABLE_ID = localStorage.getItem('TABLE_ID');
        if (!TABLE_ID) {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('table')) {
                TABLE_ID = urlParams.get('table');
                localStorage.setItem('TABLE_ID', TABLE_ID);
            } else {
                TABLE_ID = prompt("SETUP: Enter Table Number") || "00";
                localStorage.setItem('TABLE_ID', TABLE_ID);
            }
        }
        document.getElementById('table-display').innerText = `Table ${TABLE_ID}`;

        // --- SECURE RESET LOGIC ---
        function resetTable(){ 
            // Checks PIN before allowing reset
            const pin = prompt("üîí Admin: Enter PIN to change Table Number:");
            if (pin === STORE_CONFIG.adminPin) {
                if(confirm('Reset Table ID?')) { 
                    localStorage.removeItem('TABLE_ID'); 
                    location.reload(); 
                }
            } else {
                alert("Incorrect PIN!");
            }
        }

        // --- INIT ---
        async function init() {
            // 1. Fetch Store Config (Banner & PIN)
            db.collection('settings').doc('storeConfig').onSnapshot(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    STORE_CONFIG = data; // Update Config including PIN
                    // Update Banner
                    document.getElementById('ban-title').innerText = data.bannerTitle || "Hungry?";
                    document.getElementById('ban-msg').innerText = data.bannerMsg || "Enjoy!";
                    document.getElementById('ban-icon').innerText = data.bannerIcon || "üòã";
                }
            });

            // 2. Fetch Categories
            db.collection('categories').onSnapshot(snap => {
                CATEGORIES = snap.docs.map(d => ({id:d.id, ...d.data()}));
                renderSidebar();
            });

            // 3. Fetch Items
            db.collection('items').onSnapshot(snap => {
                ALL_ITEMS = snap.docs.map(d => ({id:d.id, ...d.data()}));
                renderProducts();
                updateCartUI();
            });
        }

        // --- RENDER SIDEBAR ---
        function renderSidebar() {
            const sb = document.getElementById('sidebar');
            sb.innerHTML = '<div class="brand-icon">üçî</div>';
            sb.innerHTML += `<div class="cat-item ${ACTIVE_CAT==='All'?'active':''}" onclick="setCategory('All')"><img src="https://cdn-icons-png.flaticon.com/512/1046/1046784.png" class="cat-img"><span class="cat-name">All Items</span></div>`;
            CATEGORIES.forEach(c => {
                sb.innerHTML += `<div class="cat-item ${ACTIVE_CAT===c.id?'active':''}" onclick="setCategory('${c.id}')"><img src="${c.img}" class="cat-img"><span class="cat-name">${c.name}</span></div>`;
            });
        }

        function setCategory(id) {
            ACTIVE_CAT = id;
            renderSidebar();
            renderProducts();
        }

        // --- RENDER PRODUCTS ---
        function renderProducts() {
            const container = document.getElementById('product-grid');
            const searchVal = document.getElementById('search-inp').value.toLowerCase();
            container.innerHTML = '';

            const filtered = ALL_ITEMS.filter(i => {
                const matchCat = ACTIVE_CAT === 'All' || i.category === ACTIVE_CAT;
                const matchSearch = i.name.toLowerCase().includes(searchVal);
                return matchCat && matchSearch;
            });

            if(filtered.length === 0) {
                container.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:40px; color:#999;">No items found.</div>`;
                return;
            }

            filtered.forEach(item => {
                const qty = CART[item.id] || 0;
                const img = item.image || 'https://via.placeholder.com/150';
                // Veg/Non-Veg (Mock)
                const isVeg = item.type !== 'non-veg'; 
                const vegClass = isVeg ? 'type-veg' : 'type-nonveg';

                let btnHtml = '';
                if(!item.available) {
                    btnHtml = `<div style="color:#d32f2f; font-weight:600; font-size:0.8rem;">Sold Out</div>`;
                } else if (qty === 0) {
                    btnHtml = `<button class="btn-add" onclick="updateCart('${item.id}', 1)">ADD</button>`;
                } else {
                    btnHtml = `<div class="qty-pill"><button class="qty-btn" onclick="updateCart('${item.id}', -1)">-</button><span class="qty-val">${qty}</span><button class="qty-btn" onclick="updateCart('${item.id}', 1)">+</button></div>`;
                }

                container.innerHTML += `
                    <div class="dish-card ${!item.available?'disabled':''}">
                        <div class="dish-img-box"><img src="${img}" class="dish-img"><div class="food-type ${vegClass}"><div class="dot"></div></div></div>
                        <div class="dish-info"><h3>${item.name}</h3><div class="action-row"><div class="dish-price">‚Çπ${item.price}</div>${btnHtml}</div></div>
                    </div>
                `;
            });
        }

        document.getElementById('search-inp').addEventListener('input', renderProducts);

        // --- CART LOGIC ---
        function updateCart(id, delta) {
            if(!CART[id]) CART[id] = 0;
            CART[id] += delta;
            if(CART[id] <= 0) delete CART[id];
            renderProducts();
            updateCartUI();
        }

        function updateCartUI() {
            let total = 0, count = 0;
            for(const [id, q] of Object.entries(CART)) {
                const item = ALL_ITEMS.find(i=>String(i.id)===String(id));
                if(item) { total += item.price * q; count += q; }
            }
            const bar = document.getElementById('cart-floater');
            if(count > 0) {
                bar.classList.remove('hidden');
                document.getElementById('cart-total').innerText = `‚Çπ${total}`;
                document.getElementById('cart-count').innerText = `${count} Items`;
            } else {
                bar.classList.add('hidden');
            }
        }

        // --- CHECKOUT ---
        function openCheckout() {
            const modal = document.getElementById('checkout-modal');
            const content = document.getElementById('modal-content');
            let html = `<h2>Current Order</h2><div style="max-height:300px; overflow-y:auto; margin:15px 0;">`;
            let total = 0;
            for(const [id, q] of Object.entries(CART)) {
                const item = ALL_ITEMS.find(i=>String(i.id)===String(id));
                if(item) {
                    const cost = item.price * q; total += cost;
                    html += `<div class="summary-row"><span>${q}x ${item.name}</span><span>‚Çπ${cost}</span></div>`;
                }
            }
            html += `</div><div class="summary-row" style="border:none; font-size:1.2rem; font-weight:800;"><span>Total</span><span>‚Çπ${total}</span></div><button class="btn-primary-block" onclick="placeOrder(${total})">Confirm Order</button><button class="btn-text" onclick="closeModal()">Cancel</button>`;
            content.innerHTML = html;
            modal.classList.remove('hidden');
        }

        function closeModal() { document.getElementById('checkout-modal').classList.add('hidden'); }

        async function placeOrder(total) {
            const orderItems = [];
            for(const [id, q] of Object.entries(CART)) {
                const item = ALL_ITEMS.find(i=>String(i.id)===String(id));
                if(item) orderItems.push({name:item.name, qty:q, price:item.price});
            }
            const oid = 'ORD-' + Math.floor(1000 + Math.random()*9000);
            await db.collection('orders').add({
                id: oid, tableId: TABLE_ID, items: orderItems, total: total, status: 'Received',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            CART = {}; updateCartUI();
            document.getElementById('modal-content').innerHTML = `<div style="text-align:center; padding:20px;"><div style="font-size:3rem;">üéâ</div><h2>Order Sent!</h2><p style="color:#666; margin:10px 0;">Kitchen is preparing your food.</p><div style="font-size:1.5rem; font-weight:800; color:var(--primary); margin-bottom:20px;">#${oid}</div><button class="btn-primary-block" onclick="closeModal()">Okay</button></div>`;
        }

        init();
    </script>
</body>
</html>
